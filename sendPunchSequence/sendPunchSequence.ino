// To run this, create a tinkercad with two arduinos
// Connect the arduinos togther as follows:
// GND to GND, A4 to A4, A5 to A5

// Differences between real project and this simulation:
// 1) For arduino megas, connect pins 20 together
// and pins 21 together instead of A4 and A5
// 2) SendPunchSequence() will be called when
// someone presses the Print button

#include <Wire.h>

// TinkerCAD doesn't have FastLED :'( #include <FastLED.h>
// I'll use boolean 1 or 0 instead

#define NUM_STRIPS 32
#define NUM_LEDS_PER_STRIP 32
#define NUM_PRINTER_PATTERN_BYTES 32
#define ROWS_PER_SHADED_PIXEL 2
#define BYTES_PER_ROW 4

// Caution: the led array indexing is different on TinkerCAD
// than the wowki simulator

// temporary array to make TinkerCAD simulation work
boolean leds[NUM_STRIPS][NUM_LEDS_PER_STRIP];

static const uint32_t kirby32x32_data[1024] PROGMEM = {
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff1818f9, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff1818f9, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff1818f9, 0xff1818f9, 0xff1818f9, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff1818f9, 0xff1818f9, 0xff1818f9, 0xff1818f9, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff1818f9, 0xff1818f9, 0xff1818f9, 0xff1818f9, 0xff000000, 0xff1818f9, 0xff000000, 0xff000000, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xfff06fe8, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff1818f9, 0xff1818f9, 0xff1818f9, 0xff000000, 0xff1818f9, 0xff1818f9, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 
0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000, 0xff000000
};

// TODO: program two receipt printer buttons if we want to use both
// algorithms for generating punch patterns
boolean sendSingleColourPattern = true;

void printLeadingZeroes(byte var) {
  for (int i = 0; i < 7; i++) {
    Serial.write((var >> i) & 1 ? '1' : '0');
  }
}

// maps 16 leds to one byte, 2 rows of 8 leds, starting at top left corner
byte compressSingleColourData(int row, int col)
{
    byte data = 0;

    for (int i = 0; i < 8; i++)
    {
        // TODO: uncomment the following CRGB condition for the real prototype:
        data |= (leds[row][col+i] << i); // ((leds[row][col+i] == CRGB(0x000000)) << i)
    }
    return data;
}

// can free malloc'ed memory when not using it anymore
void generateShadedPunchPattern(byte *patternBuffer)
{
    byte *shadedPatternRow = (byte *)malloc(NUM_LEDS_PER_STRIP * ROWS_PER_SHADED_PIXEL * sizeof(byte));
    byte compressedData;
    byte byteIdx = 0;

    // for each 2x2 square of leds, average the colours and map it to a shaded 2x2 punch pattern
    // the final image resolution will be reduced to 16x16
    // see the Notion page for more info
    // https://www.notion.so/SendPunchSequence-struct-punch_encoding-pattern-78d25b63250348c6a8cfb363eebb98ca
    for (int rowTopLeft = 0; rowTopLeft < NUM_LEDS_PER_STRIP; rowTopLeft += 2)
    {
        for (int colTopLeft = 0; colTopLeft < NUM_STRIPS; colTopLeft += 2)
        {
            // TODO use the actual CRGB colour mapping when prototyping IRL
            // where yellow = 1, green = 2, red = 3, blue or purple = 4
            int avgColour = (leds[rowTopLeft][colTopLeft] + leds[rowTopLeft + 1][colTopLeft] + leds[rowTopLeft][colTopLeft + 1] + leds[rowTopLeft + 1][colTopLeft + 1]) / 4;

            byte topLeftHole = colTopLeft;
            byte topRightHole = colTopLeft + 1;
            byte bottomLeftHole = 32 + colTopLeft;
            byte bottomRightHole = 32 + colTopLeft + 1;

            // intentionally omitting the "break;"" because
            // i want the remaining holes to get punched too
            switch (avgColour)
            {
            case 4:
                shadedPatternRow[bottomLeftHole] = 1;
            case 3:
                shadedPatternRow[topRightHole] = 1;
            case 2:
                shadedPatternRow[bottomRightHole] = 1;
            case 1:
                shadedPatternRow[topLeftHole] = 1;
            case 0:; // if we get here without entering the above cases, we leave the paper untouched
            }
        }

        for (int i = 0; i < NUM_LEDS_PER_STRIP * ROWS_PER_SHADED_PIXEL; i++)
        {
            if (shadedPatternRow[i] == 1)
            {
                compressedData |= (1 << i);
            }

            if ((i + 1) % 8 == 0)
            {
                patternBuffer[byteIdx] = compressedData;
                compressedData = 0;
                byteIdx++;
            }
        }
    }
    free(shadedPatternRow);
}

// punches a hole (sets a bit to 1) if the led is lit
// image resolution is compressed to 16x16
// if 2 or more leds lit in a 2x2 square, the printer punches a hole
void generatePunchPattern(byte *patternBuffer)
{
    int i = 0;
    for (int row = 0; row < NUM_STRIPS; row++)
    {
        for (int col = 0; col < NUM_LEDS_PER_STRIP; col += 8)
        {
            patternBuffer[i] = compressSingleColourData(row, col);
            i++;
        }
    }
}

// Send all 256 pixels as a 1 or 0
void sendPunchSequence()
{
    boolean doneGeneratingPattern = false;
    byte * patternBuffer = (byte *)malloc(NUM_PRINTER_PATTERN_BYTES * sizeof(byte));

    if (sendSingleColourPattern)
    {
        generatePunchPattern(patternBuffer);
    }
    else
    {
        generateShadedPunchPattern(patternBuffer);
    }

    int byteIdx = 0;
    for (int row = 0; row < NUM_STRIPS; row++)
    {
        Wire.beginTransmission(4); 

      	// transmit one row of data to device #4
        for (int bytes = 0; bytes < BYTES_PER_ROW; bytes++)
        {
            Wire.write(patternBuffer[byteIdx]);
            printLeadingZeroes(patternBuffer[byteIdx]);// TODO remove prints when done debugging
            byteIdx++;
        }
        Serial.println();
        if (Wire.endTransmission() != 0)
        {
            Serial.println("Error!");
        }
    }
    free(patternBuffer);
}

void setup()
{
    Wire.begin(); // join i2c bus (address optional for master)
    Serial.begin(9600);
  	int px = 1023;

    for (int row = NUM_STRIPS - 1; row >=0; row--)
    {
        for (int col = 0; col < NUM_LEDS_PER_STRIP; col++)
        {
          	leds[row][col] =(pgm_read_dword(&(kirby32x32_data[px]))) > 0xff000000;
            px--;
        }
    }
}

void loop()
{
    sendPunchSequence();

    // TODO program print button
    while(1); // do nothing
}
